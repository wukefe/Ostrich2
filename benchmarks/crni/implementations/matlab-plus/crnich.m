function U = crnich(a,b,c,n,m)
%-----------------------------------------------------------------------;
%;
%	This function M-file finds the Crank-Nicholson solution;
%	to the one-dimensional heat equation;
%;
%				    2;
%			u (x, t)=c u  (x, t).;
%			 t	      xx;
%;
%	The function u(x, t) denotes the temperature in a;
%	one-dimensional metal rod as a function of both the;
%	displacement x and the time t. The expression c^2 is the;
%	thermal conductivity constant. The subscript t indicates;
%	the partial derivative of u(x, t) with respect to time.;
%	The subscript xx indicates the second partial derivative of;
%	u(x, t) with respect to displacement.;
%;
%	The one-dimensional heat equation can be solved under a;
%	variety of boundary conditions. This program considers;
%	the following:;
%;
%		u(x, 0)=sin(pi*x)+sin(3*pi*x) for 0 < x < a,;
%;
%		u(0, t)=0, and u(a, t)=0 for 0 <= t <= b,;
%;
%	where a is the length of the rod, and b is the time duration.;
%;
%	For a concise background on the one-dimensional heat equation,;
%	see "Modelling: Derivation of the Heat Equation" at;
%	http://www-solar.mcs.st-and.ac.uk/~alan/MT2003/PDE/node20.html.;
%;
%	Invocation:;
%		>> U=crnich(a, b, c, n, m);
%;
%		where;
%;
%		i. a is the length of the metal rod,;
%;
%		i. b is the time duration,;
%;
%		i. c is the square root of the thermal;
%		   conductivity constant in the heat equation,;
%;
%		i. n is the number of grid points over [0, a],;
%;
%		i. m is the number of grid points over [0, b],;
%;
%		o. U is the solution matrix.;
%;
%	Requirements:;
%		None.;
%;
%	Examples:;
%		>> U=crnich(2.5, 1.5, 2, 321, 321);
%;
%	Source:;
%		Numerical Methods: MATLAB Programs,;
%		(c) John H. Mathews, 1995.;
%;
%		Accompanying text:;
%		Numerical Methods for Mathematics, Science and;
%		Engineering, 2nd Edition, 1992.;
%;
%		Prentice Hall, Englewood Cliffs,;
%		New Jersey, 07632, USA.;
%;
%		Also part of the FALCON project.;
%;
%	Author:;
%		John H. Mathews (mathews@fullerton.edu).;
%;
%	Date:;
%		March 1995.;
%;
%-----------------------------------------------------------------------;
C_PI = 3.14159265358979323846;
h = rdivide(a,minus(n,1));
r = rdivide(times(power(c,2),rdivide(b,minus(m,1))),power(h,2));
U = zeros(n, m);
i1 = colon(2,minus(n,1));
mc_t182 = 1;
U(i1, mc_t182) = plus(sin(times(times(C_PI, h),minus(i1,1))),sin(times(times(times(3,C_PI),h),minus(i1,1))));
Vd = times(plus(2,rdivide(2,r)),ones(1,n));
mc_t186 = 1;
Vd(mc_t186) = 1;
Vd(n) = 1;
Va = uminus(ones(1,minus(n,1)));
mc_t127 = minus(n,1);
Va(mc_t127) = 0;
Vc = uminus(ones(1,minus(n,1)));
mc_t195 = 1;
Vc(mc_t195) = 0;
Vb = zeros(1,n);
mc_t198 = 1;
Vb(mc_t198) = 0;
Vb(n) = 0;
mc_t208 = 2;
for j1 = (mc_t208 : m);
i1 = colon(2,minus(n,1));
if length(Vb)==length(i1)
Vb=plus(plus(U(minus(i1,1),minus(j1,1)),U(plus(i1,1),minus(j1,1))),times(minus(rdivide(2,r),2),U(i1,minus(j1,1))));
else
Vb(i1)=plus(plus(U(minus(i1,1),minus(j1,1)),U(plus(i1,1),minus(j1,1))),times(minus(rdivide(2,r),2),U(i1,minus(j1,1))));
end
mc_t128 = colon(1,n);
mc_t129 = j1;
U(mc_t128, mc_t129) = transpose(tridiagonal(Va, Vd, Vc, Vb, n));
end
end

function X = tridiagonal(A,D,C,B,n)
%-----------------------------------------------------------------------;
%;
%	This function M-file finds the solution of a tridiagonal;
%	linear system. It is assumed that D and B have dimension;
%	n, and that A and C have dimension n-1.;
%;
%	Invocation:;
%		>> X=tridiagonal(A, D, C, B);
%;
%		where;
%;
%		i. A is a subdiagonal row vector,;
%;
%		i. D is a diagonal row vector,;
%;
%		i. C is the superdiagonal row vector,;
%;
%		i. B is the right-hand side row vector,;
%;
%		o. X is the solution row vector.;
%;
%	Requirements:;
%		None.;
%;
%	Examples:;
%		>> X=tridiagonal([1, 2, 3], [1, 2, 3, 4], ...;
%		[1, 2, 3], [1, 2, 3, 4]);
%;
%	Source:;
%		Numerical Methods: MATLAB Programs,;
%		(c) John H. Mathews, 1995.;
%;
%		Accompanying text:;
%		Numerical Methods for Mathematics, Science and;
%		Engineering, 2nd Edition, 1992.;
%;
%		Prentice Hall, Englewood Cliffs,;
%		New Jersey, 07632, USA.;
%;
%	Author:;
%		John H. Mathews (mathews@fullerton.edu).;
%;
%	Date:;
%		March 1995.;
%;
%-----------------------------------------------------------------------;
% n=size(B, 2);;
mc_t242 = 2;
for k = (mc_t242 : n);
mult = rdivide(A(minus(k,1)),D(minus(k,1)));
D(k) = minus(D(k),times(mult,C(minus(k,1))));
B(k) = minus(B(k),times(mult,B(minus(k,1))));
end
X = zeros(1,n);
X(n) = rdivide(B(n),D(n));
k = colon(minus(n,1),uminus(1),1);
if length(X)==length(k)
X=rdivide(minus(B(k),times(C(k),X(plus(k,1)))),D(k));
else
X(k)=rdivide(minus(B(k),times(C(k),X(plus(k,1)))),D(k));
end
end

